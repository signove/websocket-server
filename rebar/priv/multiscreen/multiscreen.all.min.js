"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var MULTISCREEN={SENDER_ON:"SENDER_ON",SENDER_OFF:"SENDER_OFF",RECEIVER_ON:"RECEIVER_ON",RECEIVER_OFF:"RECEIVER_OFF"},_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),MultiScreen=function(){function e(){_classCallCheck(this,e),this.mSessionKey=void 0,this.mClientKey=void 0,this.mWebSocketRTObject=void 0,this.mWebSocketConfigObject=void 0}return _createClass(e,[{key:"connect",value:function(e,n,t){var o=this;return this.mWebSocketRTObject?this.disconnect().then(function(){return o.connect(e,n,t)}):(this.mWebSocketRTObject=new WebSocket(e+"?session="+encodeURIComponent(n)+"&client="+encodeURIComponent(t)),this.mWebSocketRTObject.binaryType="arraybuffer"),this.secretConfigKey=void 0,new Promise(function(c,i){o.mWebSocketRTObject.onopen=function(e){o.mSessionKey=n,o.mClientKey=t},o.mWebSocketRTObject.onmessage=function(n){o.secretConfigKey=n.data,o.mWebSocketConfigObject=new WebSocket(e+"/config?secret_config_key="+encodeURIComponent(o.secretConfigKey)+"&session="+encodeURIComponent(o.mSessionKey)+"&client="+encodeURIComponent(o.mClientKey)),o.mWebSocketConfigObject.binaryType="arraybuffer",o.mWebSocketConfigObject.onopen=function(e){c({sessionKey:o.mSessionKey,myKey:o.mClientKey})},o.mWebSocketConfigObject.onerror=function(e){o.mWebSocketConfigObject=void 0},o.mWebSocketConfigObject.onmessage=function(e){document.dispatchEvent(new CustomEvent("multiscreen.config.message",{detail:{message:e.data}}))},o.mWebSocketRTObject.onmessage=function(e){var n=e.data.substring(0,e.data.indexOf("#")),t=e.data.substr(e.data.indexOf("#")+1);document.dispatchEvent(new CustomEvent("multiscreen.message",{detail:{sender:n,message:t}}))}},o.mWebSocketRTObject.onerror=function(e){o.mSessionKey=void 0,o.mClientKey=void 0,o.mWebSocketConfigObject=void 0,i(e)}})}},{key:"disconnect",value:function(){var e=this;this.mWebSocketRTObject&&this.mWebSocketRTObject.close(),this.mWebSocketConfigObject&&this.mWebSocketConfigObject.close();var n=new Promise(function(n,t){e.mWebSocketRTObject?e.mWebSocketRTObject.onclose=function(t){e.mWebSocketRTObject=void 0,n("RT session closed")}:n("RT session not opened")}),t=new Promise(function(n,t){e.mWebSocketConfigObject?e.mWebSocketConfigObject.onclose=function(t){e.mWebSocketConfigObject=void 0,n("Config session closed")}:n("Config session not opened")});return Promise.all([n,t])}},{key:"send",value:function(e){var n=this,t=arguments.length<=1||void 0===arguments[1]?"all":arguments[1];if(void 0!==this.mWebSocketRTObject){var o={data:e,receiver:t};this.mWebSocketRTObject.send(JSON.stringify(o))}return new Promise(function(e,t){void 0===n.mWebSocketRTObject?t({message:"It is not connected!"}):e()})}},{key:"sendConfigMessage",value:function(e){var n=this;return void 0!==this.mWebSocketConfigObject&&this.mWebSocketConfigObject.send(e),new Promise(function(e,t){void 0===n.mWebSocketConfigObject?t({message:"It is not connected!"}):e()})}}]),e}(),_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),Utils=function(){function Utils(){_classCallCheck(this,Utils)}return _createClass(Utils,null,[{key:"uuid",value:function e(){function n(){var e=4,n=Math.pow(16,e-1);return(Math.random()*(Math.pow(16,e)-n)+n|0).toString(16)}var e=[n()+n(),n(),n(),n(),n()+n()+n()];return e.join("-")}},{key:"execJavascript",value:function execJavascript(code){eval(code)}}]),Utils}();
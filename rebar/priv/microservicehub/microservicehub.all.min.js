/*! Micro-Service-HUB-JS-library 2023-05-23 */
class MicroServiceHUB{constructor(){this.mSessionKey=void 0,this.mClientKey=void 0,this.mWebSocketRTObject=void 0}connect(e,n,i){return this.mWebSocketRTObject?this.disconnect().then(()=>this.connect(e,n,i)):(this.mWebSocketRTObject=new WebSocket(e+"?session="+encodeURIComponent(n)+"&client="+encodeURIComponent(i)),this.mWebSocketRTObject.binaryType="arraybuffer"),this.secretClientKey=void 0,new Promise((e,t)=>{this.mWebSocketRTObject.onopen=e=>{this.mSessionKey=n,this.mClientKey=i},this.mWebSocketRTObject.onmessage=e=>{var t,n,i;e.data instanceof ArrayBuffer?({command:t,sender:n,payload:i}=Utils.readMicroServiceHUBMessage(e.data),this.secretClientKey=Utils.arrayBufferToString(i)):this.secretClientKey=e.data,this.mWebSocketRTObject.onmessage=e=>{var t,n,i;e.data instanceof ArrayBuffer?{command:t,sender:n,payload:i}=Utils.readMicroServiceHUBMessage(e.data):e.data,document.dispatchEvent(new CustomEvent("microservicehub.message",{detail:{command:t,sender:n,message:i}}))}},this.mWebSocketRTObject.onerror=e=>{this.mSessionKey=void 0,this.mClientKey=void 0,t(e)}})}disconnect(){this.mWebSocketRTObject&&this.mWebSocketRTObject.close();var e=new Promise((t,e)=>{this.mWebSocketRTObject?this.mWebSocketRTObject.onclose=e=>{this.mWebSocketRTObject=void 0,t("RT session closed")}:t("RT session not opened")});return Promise.all([e])}send(e){return void 0!==this.mWebSocketRTObject&&this.mWebSocketRTObject.send(e),new Promise((e,t)=>{void 0===this.mWebSocketRTObject?t({message:"It is not connected!"}):e()})}}class Utils{constructor(){}static uuid(){function e(){var e=Math.pow(16,3);return(Math.random()*(Math.pow(16,4)-e)+e|0).toString(16)}return[e()+e(),e(),e(),e(),e()+e()+e()].join("-")}static execJavascript(code){eval(code)}static arrayBufferToString(e){return String.fromCharCode.apply(null,new Uint8Array(e))}static stringToArrayBuffer(e,t=e.length){for(var t=new ArrayBuffer(t),n=new Uint8Array(t),i=0,r=e.length;i<r;i++)n[i]=e.charCodeAt(i);return t}static readMicroServiceHUBMessage(e){var t=[],n=void 0,i=void 0,r=void 0,a=new DataView(e,0,2).getUint16(0);if(1==a){for(var r=new DataView(e,2,20),s=0;s<r.byteLength&&0!=r.getUint8(s);s++)t[s]=String.fromCharCode(r.getUint8(s));return{sender:n=t.join(""),payload:i=e.slice(22)}}if(2!=a)return{sender:n,payload:i};for(a=new DataView(e,2,1),a=(r=new DataView(e,3,20),a.getUint8(0)),s=0;s<r.byteLength&&0!=r.getUint8(s);s++)t[s]=String.fromCharCode(r.getUint8(s));return{command:a,sender:n=t.join(""),payload:i=e.slice(23)}}static createMicroServiceHUBMessageV1(e,t=""){t=t.substring(0,20);for(var n=new ArrayBuffer(22+e.byteLength),i=(new DataView(n).setUint16(0,1),new DataView(n,2,20)),r=0;r<t.length;r++)i.setUint8(r,t.charCodeAt(r));for(var a=new DataView(e),s=new DataView(n,22),r=0;r<a.byteLength;r++)s.setUint8(r,a.getUint8(r));return n}static createMicroServiceHUBMessageV2(e,t,n=""){n=n.substring(0,20);for(var i=new ArrayBuffer(23+t.byteLength),r=(new DataView(i).setUint16(0,2),new DataView(i,2,20)),a=0;a<n.length;a++)r.setUint8(a,n.charCodeAt(a));new DataView(i,22,1).setUint8(0,e);for(var s=new DataView(t),o=new DataView(i,23),a=0;a<s.byteLength;a++)o.setUint8(a,s.getUint8(a));return i}}
//# sourceMappingURL=microservicehub.all.min.js.map